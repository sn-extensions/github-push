{"version":3,"sources":["app.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","ComponentManager","permissions","onReady","sentMessages","messageQueue","loggingEnabled","acceptsThemes","activeThemes","initialPermissions","onReadyCallback","coallesedSaving","coallesedSavingDelay","registerMessageHandler","value","_this","messageHandler","event","console","log","data","document","referrer","URL","origin","eventOrigin","parsedData","JSON","parse","handleMessage","addEventListener","window","payload","action","sessionKey","componentData","activateThemes","themes","original","originalMessage","filter","message","messageId","alert","callback","environment","platform","uuid","isMobile","requestPermissions","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_iterator","Symbol","iterator","_step","next","done","postMessage","err","activeThemeUrls","getSelfComponentUUID","isRunningInDesktopApplication","setComponentDataValueForKey","clearComponentData","componentDataValueForKey","push","generateUUID","api","sentMessage","stringify","parent","setSize","type","width","height","bind","streamItems","contentTypes","Array","isArray","content_types","items","streamContextItem","_this2","item","isNewItem","lastStreamedItem","pendingSaveTimeout","clearTimeout","_performSavingOfItems","pendingSaveParams","selectItem","jsonObjectForItem","createItem","associateItem","createItems","_this3","mapped","map","deassociateItem","clearSelection","content_type","deleteItem","deleteItems","params","sendCustomEvent","saveItem","skipDebouncer","arguments","saveItems","saveItemWithPresave","presave","saveItemsWithPresave","_ref","mappedItems","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","_this4","pendingSaveItems","incomingIds","preexistingItems","includes","concat","setTimeout","copy","assign","children","getItemAppDataValue","AppDomain","content","appData","incomingUrls","sort","toString","themesToActivate","themesToDeactivate","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_iterator3","_step3","activeUrl","candidate","_i","_themesToDeactivate","theme","deactivateTheme","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_iterator4","_step4","url","link","createElement","id","btoa","href","rel","media","className","getElementsByTagName","appendChild","themeElementForUrl","elements","from","getElementsByClassName","slice","find","element","disabled","parentNode","removeChild","crypto","msCrypto","buf","Uint32Array","getRandomValues","idx","replace","c","r","v","d","Date","getTime","performance","now","Math","random","floor","module","exports","angular","HomeCtrl","$rootScope","$scope","$timeout","formData","loading","pushStatus","name","componentManager","defaultHeight","note","repos","loadRepoDataForCurrentNote","token","onTokenSet","submitToken","gh","GitHub","me","getUser","loadingRepos","listRepos","noteData","savedNote","noteFileExtension","fileExtension","noteFileDirectory","fileDirectory","selectRepoWithName","repoName","defaultRepo","defaultFileExtension","defaultFileDirectory","selectedRepo","repo","didSelectRepo","selectedRepoObject","getRepo","owner","login","setDataForNote","hasDefaultRepo","notesData","sanitizeFileDirectory","$directory","pushChanges","$event","blur","commitMessage","title","writeFile","text","encode","result","logout","$$ngIsClass","controller"],"mappings":"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","file":"app.js","sourcesContent":["\"use strict\";\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar ComponentManager =\n/*#__PURE__*/\nfunction () {\n  function ComponentManager(permissions, onReady) {\n    _classCallCheck(this, ComponentManager);\n\n    this.sentMessages = [];\n    this.messageQueue = [];\n    this.loggingEnabled = false;\n    this.acceptsThemes = true;\n    this.activeThemes = [];\n    this.initialPermissions = permissions;\n    this.onReadyCallback = onReady;\n    this.coallesedSaving = true;\n    this.coallesedSavingDelay = 250;\n    this.registerMessageHandler();\n  }\n\n  _createClass(ComponentManager, [{\n    key: \"registerMessageHandler\",\n    value: function registerMessageHandler() {\n      var _this = this;\n\n      var messageHandler = function messageHandler(event) {\n        if (_this.loggingEnabled) {\n          console.log(\"Components API Message received:\", event.data);\n        } // We don't have access to window.parent.origin due to cross-domain restrictions.\n        // Check referrer if available, otherwise defer to checking for first-run value.\n        // Craft URL objects so that example.com === example.com/\n\n\n        if (document.referrer) {\n          var referrer = new URL(document.referrer).origin;\n          var eventOrigin = new URL(event.origin).origin;\n\n          if (referrer !== eventOrigin) {\n            return;\n          }\n        } // The first message will be the most reliable one, so we won't change it after any subsequent events,\n        // in case you receive an event from another window.\n\n\n        if (!_this.origin) {\n          _this.origin = event.origin;\n        } else if (event.origin !== _this.origin) {\n          // If event origin doesn't match first-run value, return.\n          return;\n        } // Mobile environment sends data as JSON string\n\n\n        var data = event.data;\n        var parsedData = typeof data === \"string\" ? JSON.parse(data) : data;\n\n        _this.handleMessage(parsedData);\n      };\n      /*\n        Mobile (React Native) uses `document`, web/desktop uses `window`.addEventListener\n        for postMessage API to work properly.\n         Update May 2019:\n        As part of transitioning React Native webview into the community package,\n        we'll now only need to use window.addEventListener.\n         However, we want to maintain backward compatibility for Mobile < v3.0.5, so we'll keep document.addEventListener\n         Also, even with the new version of react-native-webview, Android may still require document.addEventListener (while iOS still only requires window.addEventListener)\n        https://github.com/react-native-community/react-native-webview/issues/323#issuecomment-467767933\n       */\n\n\n      document.addEventListener(\"message\", function (event) {\n        messageHandler(event);\n      }, false);\n      window.addEventListener(\"message\", function (event) {\n        messageHandler(event);\n      }, false);\n    }\n  }, {\n    key: \"handleMessage\",\n    value: function handleMessage(payload) {\n      if (payload.action === \"component-registered\") {\n        this.sessionKey = payload.sessionKey;\n        this.componentData = payload.componentData;\n        this.onReady(payload.data);\n\n        if (this.loggingEnabled) {\n          console.log(\"Component successfully registered with payload:\", payload);\n        }\n      } else if (payload.action === \"themes\") {\n        if (this.acceptsThemes) {\n          this.activateThemes(payload.data.themes);\n        }\n      } else if (payload.original) {\n        // get callback from queue\n        var originalMessage = this.sentMessages.filter(function (message) {\n          return message.messageId === payload.original.messageId;\n        })[0];\n\n        if (!originalMessage) {\n          // Connection must have been reset. Alert the user.\n          alert(\"This extension is attempting to communicate with Standard Notes, but an error is preventing it from doing so. Please restart this extension and try again.\");\n        }\n\n        if (originalMessage.callback) {\n          originalMessage.callback(payload.data);\n        }\n      }\n    }\n  }, {\n    key: \"onReady\",\n    value: function onReady(data) {\n      this.environment = data.environment;\n      this.platform = data.platform;\n      this.uuid = data.uuid;\n      this.isMobile = this.environment == \"mobile\";\n\n      if (this.initialPermissions && this.initialPermissions.length > 0) {\n        this.requestPermissions(this.initialPermissions);\n      }\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.messageQueue[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var message = _step.value;\n          this.postMessage(message.action, message.data, message.callback);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator[\"return\"] != null) {\n            _iterator[\"return\"]();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      this.messageQueue = [];\n\n      if (this.loggingEnabled) {\n        console.log(\"onReadyData\", data);\n      }\n\n      this.activateThemes(data.activeThemeUrls || []);\n\n      if (this.onReadyCallback) {\n        this.onReadyCallback();\n      }\n    }\n  }, {\n    key: \"getSelfComponentUUID\",\n    value: function getSelfComponentUUID() {\n      return this.uuid;\n    }\n  }, {\n    key: \"isRunningInDesktopApplication\",\n    value: function isRunningInDesktopApplication() {\n      return this.environment === \"desktop\";\n    }\n  }, {\n    key: \"setComponentDataValueForKey\",\n    value: function setComponentDataValueForKey(key, value) {\n      this.componentData[key] = value;\n      this.postMessage(\"set-component-data\", {\n        componentData: this.componentData\n      }, function (data) {});\n    }\n  }, {\n    key: \"clearComponentData\",\n    value: function clearComponentData() {\n      this.componentData = {};\n      this.postMessage(\"set-component-data\", {\n        componentData: this.componentData\n      }, function (data) {});\n    }\n  }, {\n    key: \"componentDataValueForKey\",\n    value: function componentDataValueForKey(key) {\n      return this.componentData[key];\n    }\n  }, {\n    key: \"postMessage\",\n    value: function postMessage(action, data, callback) {\n      if (!this.sessionKey) {\n        this.messageQueue.push({\n          action: action,\n          data: data,\n          callback: callback\n        });\n        return;\n      }\n\n      var message = {\n        action: action,\n        data: data,\n        messageId: this.generateUUID(),\n        sessionKey: this.sessionKey,\n        api: \"component\"\n      };\n      var sentMessage = JSON.parse(JSON.stringify(message));\n      sentMessage.callback = callback;\n      this.sentMessages.push(sentMessage); // Mobile (React Native) requires a string for the postMessage API.\n\n      if (this.isMobile) {\n        message = JSON.stringify(message);\n      }\n\n      if (this.loggingEnabled) {\n        console.log(\"Posting message:\", message);\n      }\n\n      window.parent.postMessage(message, this.origin);\n    }\n  }, {\n    key: \"setSize\",\n    value: function setSize(type, width, height) {\n      this.postMessage(\"set-size\", {\n        type: type,\n        width: width,\n        height: height\n      }, function (data) {});\n    }\n  }, {\n    key: \"requestPermissions\",\n    value: function requestPermissions(permissions, callback) {\n      this.postMessage(\"request-permissions\", {\n        permissions: permissions\n      }, function (data) {\n        callback && callback();\n      }.bind(this));\n    }\n  }, {\n    key: \"streamItems\",\n    value: function streamItems(contentTypes, callback) {\n      if (!Array.isArray(contentTypes)) {\n        contentTypes = [contentTypes];\n      }\n\n      this.postMessage(\"stream-items\", {\n        content_types: contentTypes\n      }, function (data) {\n        callback(data.items);\n      }.bind(this));\n    }\n  }, {\n    key: \"streamContextItem\",\n    value: function streamContextItem(callback) {\n      var _this2 = this;\n\n      this.postMessage(\"stream-context-item\", null, function (data) {\n        var item = data.item;\n        /*\n          If this is a new context item than the context item the component was currently entertaining,\n          we want to immediately commit any pending saves, because if you send the new context item to the\n          component before it has commited its presave, it will end up first replacing the UI with new context item,\n          and when the debouncer executes to read the component UI, it will be reading the new UI for the previous item.\n        */\n\n        var isNewItem = !_this2.lastStreamedItem || _this2.lastStreamedItem.uuid !== item.uuid;\n\n        if (isNewItem && _this2.pendingSaveTimeout) {\n          clearTimeout(_this2.pendingSaveTimeout);\n\n          _this2._performSavingOfItems(_this2.pendingSaveParams);\n\n          _this2.pendingSaveTimeout = null;\n          _this2.pendingSaveParams = null;\n        }\n\n        _this2.lastStreamedItem = item;\n        callback(_this2.lastStreamedItem);\n      });\n    }\n  }, {\n    key: \"selectItem\",\n    value: function selectItem(item) {\n      this.postMessage(\"select-item\", {\n        item: this.jsonObjectForItem(item)\n      });\n    }\n  }, {\n    key: \"createItem\",\n    value: function createItem(item, callback) {\n      this.postMessage(\"create-item\", {\n        item: this.jsonObjectForItem(item)\n      }, function (data) {\n        var item = data.item; // A previous version of the SN app had an issue where the item in the reply to create-item\n        // would be nested inside \"items\" and not \"item\". So handle both cases here.\n\n        if (!item && data.items && data.items.length > 0) {\n          item = data.items[0];\n        }\n\n        this.associateItem(item);\n        callback && callback(item);\n      }.bind(this));\n    }\n  }, {\n    key: \"createItems\",\n    value: function createItems(items, callback) {\n      var _this3 = this;\n\n      var mapped = items.map(function (item) {\n        return _this3.jsonObjectForItem(item);\n      });\n      this.postMessage(\"create-items\", {\n        items: mapped\n      }, function (data) {\n        callback && callback(data.items);\n      }.bind(this));\n    }\n  }, {\n    key: \"associateItem\",\n    value: function associateItem(item) {\n      this.postMessage(\"associate-item\", {\n        item: this.jsonObjectForItem(item)\n      });\n    }\n  }, {\n    key: \"deassociateItem\",\n    value: function deassociateItem(item) {\n      this.postMessage(\"deassociate-item\", {\n        item: this.jsonObjectForItem(item)\n      });\n    }\n  }, {\n    key: \"clearSelection\",\n    value: function clearSelection() {\n      this.postMessage(\"clear-selection\", {\n        content_type: \"Tag\"\n      });\n    }\n  }, {\n    key: \"deleteItem\",\n    value: function deleteItem(item, callback) {\n      this.deleteItems([item], callback);\n    }\n  }, {\n    key: \"deleteItems\",\n    value: function deleteItems(items, callback) {\n      var params = {\n        items: items.map(function (item) {\n          return this.jsonObjectForItem(item);\n        }.bind(this))\n      };\n      this.postMessage(\"delete-items\", params, function (data) {\n        callback && callback(data);\n      });\n    }\n  }, {\n    key: \"sendCustomEvent\",\n    value: function sendCustomEvent(action, data, callback) {\n      this.postMessage(action, data, function (data) {\n        callback && callback(data);\n      }.bind(this));\n    }\n  }, {\n    key: \"saveItem\",\n    value: function saveItem(item, callback) {\n      var skipDebouncer = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      this.saveItems([item], callback, skipDebouncer);\n    }\n    /* Presave allows clients to perform any actions last second before the save actually occurs (like setting previews).\n       Saves debounce by default, so if a client needs to compute a property on an item before saving, it's best to\n       hook into the debounce cycle so that clients don't have to implement their own debouncing.\n     */\n\n  }, {\n    key: \"saveItemWithPresave\",\n    value: function saveItemWithPresave(item, presave, callback) {\n      this.saveItemsWithPresave([item], presave, callback);\n    }\n  }, {\n    key: \"saveItemsWithPresave\",\n    value: function saveItemsWithPresave(items, presave, callback) {\n      this.saveItems(items, callback, false, presave);\n    }\n  }, {\n    key: \"_performSavingOfItems\",\n    value: function _performSavingOfItems(_ref) {\n      var items = _ref.items,\n          presave = _ref.presave,\n          callback = _ref.callback;\n      // presave block allows client to gain the benefit of performing something in the debounce cycle.\n      presave && presave();\n      var mappedItems = [];\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = items[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var item = _step2.value;\n          mappedItems.push(this.jsonObjectForItem(item));\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2[\"return\"] != null) {\n            _iterator2[\"return\"]();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      this.postMessage(\"save-items\", {\n        items: mappedItems\n      }, function (data) {\n        callback && callback();\n      });\n    }\n    /*\n    skipDebouncer allows saves to go through right away rather than waiting for timeout.\n    This should be used when saving items via other means besides keystrokes.\n    */\n\n  }, {\n    key: \"saveItems\",\n    value: function saveItems(items, callback) {\n      var _this4 = this;\n\n      var skipDebouncer = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      var presave = arguments.length > 3 ? arguments[3] : undefined;\n\n      // We need to make sure that when we clear a pending save timeout,\n      // we carry over those pending items into the new save.\n      if (!this.pendingSaveItems) {\n        this.pendingSaveItems = [];\n      }\n\n      if (this.coallesedSaving == true && !skipDebouncer) {\n        if (this.pendingSaveTimeout) {\n          clearTimeout(this.pendingSaveTimeout);\n        }\n\n        var incomingIds = items.map(function (item) {\n          return item.uuid;\n        }); // Replace any existing save items with incoming values\n        // Only keep items here who are not in incomingIds\n\n        var preexistingItems = this.pendingSaveItems.filter(function (item) {\n          return !incomingIds.includes(item.uuid);\n        }); // Add new items, now that we've made sure it's cleared of incoming items.\n\n        this.pendingSaveItems = preexistingItems.concat(items); // We'll potentially need to commit early if stream-context-item message comes in\n\n        this.pendingSaveParams = {\n          items: this.pendingSaveItems,\n          presave: presave,\n          callback: callback\n        };\n        this.pendingSaveTimeout = setTimeout(function () {\n          _this4._performSavingOfItems(_this4.pendingSaveParams);\n\n          _this4.pendingSaveItems = [];\n          _this4.pendingSaveTimeout = null;\n          _this4.pendingSaveParams = null;\n        }, this.coallesedSavingDelay);\n      } else {\n        this._performSavingOfItems({\n          items: items,\n          presave: presave,\n          callback: callback\n        });\n      }\n    }\n  }, {\n    key: \"jsonObjectForItem\",\n    value: function jsonObjectForItem(item) {\n      var copy = Object.assign({}, item);\n      copy.children = null;\n      copy.parent = null;\n      return copy;\n    }\n  }, {\n    key: \"getItemAppDataValue\",\n    value: function getItemAppDataValue(item, key) {\n      var AppDomain = \"org.standardnotes.sn\";\n      var data = item.content.appData && item.content.appData[AppDomain];\n\n      if (data) {\n        return data[key];\n      } else {\n        return null;\n      }\n    }\n    /* Themes */\n\n  }, {\n    key: \"activateThemes\",\n    value: function activateThemes(incomingUrls) {\n      if (this.loggingEnabled) {\n        console.log(\"Incoming themes\", incomingUrls);\n      }\n\n      if (this.activeThemes.sort().toString() == incomingUrls.sort().toString()) {\n        // incoming are same as active, do nothing\n        return;\n      }\n\n      var themesToActivate = incomingUrls || [];\n      var themesToDeactivate = [];\n      var _iteratorNormalCompletion3 = true;\n      var _didIteratorError3 = false;\n      var _iteratorError3 = undefined;\n\n      try {\n        for (var _iterator3 = this.activeThemes[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n          var activeUrl = _step3.value;\n\n          if (!incomingUrls.includes(activeUrl)) {\n            // active not present in incoming, deactivate it\n            themesToDeactivate.push(activeUrl);\n          } else {\n            // already present in active themes, remove it from themesToActivate\n            themesToActivate = themesToActivate.filter(function (candidate) {\n              return candidate != activeUrl;\n            });\n          }\n        }\n      } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion3 && _iterator3[\"return\"] != null) {\n            _iterator3[\"return\"]();\n          }\n        } finally {\n          if (_didIteratorError3) {\n            throw _iteratorError3;\n          }\n        }\n      }\n\n      if (this.loggingEnabled) {\n        console.log(\"Deactivating themes:\", themesToDeactivate);\n        console.log(\"Activating themes:\", themesToActivate);\n      }\n\n      for (var _i = 0, _themesToDeactivate = themesToDeactivate; _i < _themesToDeactivate.length; _i++) {\n        var theme = _themesToDeactivate[_i];\n        this.deactivateTheme(theme);\n      }\n\n      this.activeThemes = incomingUrls;\n      var _iteratorNormalCompletion4 = true;\n      var _didIteratorError4 = false;\n      var _iteratorError4 = undefined;\n\n      try {\n        for (var _iterator4 = themesToActivate[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n          var url = _step4.value;\n\n          if (!url) {\n            continue;\n          }\n\n          var link = document.createElement(\"link\");\n          link.id = btoa(url);\n          link.href = url;\n          link.type = \"text/css\";\n          link.rel = \"stylesheet\";\n          link.media = \"screen,print\";\n          link.className = \"custom-theme\";\n          document.getElementsByTagName(\"head\")[0].appendChild(link);\n        }\n      } catch (err) {\n        _didIteratorError4 = true;\n        _iteratorError4 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion4 && _iterator4[\"return\"] != null) {\n            _iterator4[\"return\"]();\n          }\n        } finally {\n          if (_didIteratorError4) {\n            throw _iteratorError4;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"themeElementForUrl\",\n    value: function themeElementForUrl(url) {\n      var elements = Array.from(document.getElementsByClassName(\"custom-theme\")).slice();\n      return elements.find(function (element) {\n        // We used to search here by `href`, but on desktop, with local file:// urls, that didn't work for some reason.\n        return element.id == btoa(url);\n      });\n    }\n  }, {\n    key: \"deactivateTheme\",\n    value: function deactivateTheme(url) {\n      var element = this.themeElementForUrl(url);\n\n      if (element) {\n        element.disabled = true;\n        element.parentNode.removeChild(element);\n      }\n    }\n    /* Theme caching is currently disabled. Might be enabled in the future if neccessary. */\n\n    /*\n    activateCachedThemes() {\n      let themes = this.getCachedThemeUrls();\n      let writeToCache = false;\n      if(this.loggingEnabled) { console.log(\"Activating cached themes\", themes); }\n      this.activateThemes(themes, writeToCache);\n    }\n     cacheThemeUrls(urls) {\n      if(this.loggingEnabled) { console.log(\"Caching theme urls\", urls); }\n      localStorage.setItem(\"cachedThemeUrls\", JSON.stringify(urls));\n    }\n     decacheThemeUrls() {\n      localStorage.removeItem(\"cachedThemeUrls\");\n    }\n     getCachedThemeUrls() {\n      let urls = localStorage.getItem(\"cachedThemeUrls\");\n      if(urls) {\n        return JSON.parse(urls);\n      } else {\n        return [];\n      }\n    }\n    */\n\n    /* Utilities */\n\n  }, {\n    key: \"generateUUID\",\n    value: function generateUUID() {\n      var crypto = window.crypto || window.msCrypto;\n\n      if (crypto) {\n        var buf = new Uint32Array(4);\n        crypto.getRandomValues(buf);\n        var idx = -1;\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n          idx++;\n          var r = buf[idx >> 3] >> idx % 8 * 4 & 15;\n          var v = c == 'x' ? r : r & 0x3 | 0x8;\n          return v.toString(16);\n        });\n      } else {\n        var d = new Date().getTime();\n\n        if (window.performance && typeof window.performance.now === \"function\") {\n          d += performance.now(); //use high-precision timer if available\n        }\n\n        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n          var r = (d + Math.random() * 16) % 16 | 0;\n          d = Math.floor(d / 16);\n          return (c == 'x' ? r : r & 0x3 | 0x8).toString(16);\n        });\n        return uuid;\n      }\n    }\n  }]);\n\n  return ComponentManager;\n}();\n\nif (typeof module != \"undefined\" && typeof module.exports != \"undefined\") {\n  module.exports = ComponentManager;\n}\n\nif (window) {\n  window.ComponentManager = ComponentManager;\n}\n//# sourceMappingURL=dist.js.map\n;'use strict';\n\nangular.module('app', [\n\n])\n;class HomeCtrl {\n  constructor($rootScope, $scope, $timeout) {\n\n    $scope.formData = {loading: true, pushStatus: \"Push Changes\"};\n\n    var permissions = [\n      {\n        name: \"stream-context-item\"\n      }\n    ]\n\n    let componentManager = new window.ComponentManager(permissions, function(){\n      $scope.formData.loading = false;\n      $scope.onReady();\n    });\n\n    let defaultHeight = 60;\n\n    componentManager.streamContextItem(function(item){\n      $timeout(function(){\n        $scope.note = item;\n        if($scope.repos) {\n          $scope.loadRepoDataForCurrentNote();\n        }\n      })\n    })\n\n    $scope.onReady = function() {\n      $scope.token = componentManager.componentDataValueForKey(\"token\");\n      if($scope.token) {\n        $scope.onTokenSet();\n      }\n    }\n\n    $scope.submitToken = function() {\n      $scope.token = $scope.formData.token;\n      componentManager.setComponentDataValueForKey(\"token\", $scope.token);\n      $scope.onTokenSet();\n    }\n\n    $scope.onTokenSet = function() {\n\n      $scope.gh = new GitHub({\n        token: $scope.token\n      });\n\n      var me = $scope.gh.getUser();\n      $scope.formData.loadingRepos = true;\n\n      me.listRepos(function(err, repos) {\n        $timeout(function(){\n          $scope.formData.loadingRepos = false;\n          if(err) {\n            alert(\"An error occurred with the GitHub Push extension. Make sure your GitHub token is valid and try again.\")\n            return;\n          }\n          $scope.repos = repos;\n          if($scope.note) {\n            $scope.loadRepoDataForCurrentNote();\n          }\n        })\n      });\n    }\n\n    $scope.loadRepoDataForCurrentNote = function() {\n      var noteData = componentManager.componentDataValueForKey(\"notes\") || {};\n      var savedNote = noteData[$scope.note.uuid];\n      if(savedNote) {\n        // per note preference\n        $scope.noteFileExtension = savedNote.fileExtension;\n        $scope.noteFileDirectory = savedNote.fileDirectory;\n        $scope.selectRepoWithName(savedNote.repoName);\n      } else {\n        // default pref\n        var defaultRepo = componentManager.componentDataValueForKey(\"defaultRepo\");\n        if(defaultRepo) {\n          $scope.selectRepoWithName(defaultRepo);\n        }\n      }\n\n      $scope.defaultFileExtension = componentManager.componentDataValueForKey(\"defaultFileExtension\");\n      $scope.formData.fileExtension = $scope.noteFileExtension || $scope.defaultFileExtension || \"txt\";\n\n      $scope.defaultFileDirectory = componentManager.componentDataValueForKey(\"defaultFileDirectory\");\n      $scope.formData.fileDirectory = $scope.noteFileDirectory || $scope.defaultFileDirectory || \"\";\n    }\n\n\n    $scope.selectRepoWithName = function(name) {\n      $scope.formData.selectedRepo = $scope.repos.filter(function(repo){\n        return repo.name === name;\n      })[0];\n      $scope.didSelectRepo();\n    }\n\n    $scope.didSelectRepo = function() {\n      var repo = $scope.formData.selectedRepo;\n      $scope.selectedRepoObject = $scope.gh.getRepo(repo.owner.login, repo.name);\n\n      // save this as default repo for this note\n      $scope.setDataForNote(\"repoName\", repo.name);\n\n      // save this as default repo globally\n      if(!$scope.hasDefaultRepo) {\n        componentManager.setComponentDataValueForKey(\"defaultRepo\", repo.name);\n        $scope.hasDefaultRepo = true;\n      }\n    }\n\n    $scope.setDataForNote = function(key, value) {\n      var notesData = componentManager.componentDataValueForKey(\"notes\") || {};\n      var noteData = notesData[$scope.note.uuid] || {};\n      /**\n       * Skip updating the component data if the current value and the new value for the key are the same.\n       * This will prevent spamming the postMessage API with the same message, which causes high CPU usage.\n       */\n      if (noteData[key] === value) {\n        return;\n      }\n      noteData[key] = value;\n      notesData[$scope.note.uuid] = noteData;\n      componentManager.setComponentDataValueForKey(\"notes\", notesData);\n    }\n\n    $scope.sanitizeFileDirectory = function($directory) {\n      // if no directory is given, then push to root.\n      if (!$directory)\n        return '';\n\n      // try to ensure they haven't attempted any funny business with escape strings by turning\n      // any backslashes into forward slashes - then replace any duplicate slashes with a single\n      // slash.\n      return $directory = $directory\n        // make sure the last symbol is a '/'\n        .replace(/[/]*$/g, '/')\n        // make sure there are no escaping slashes.\n        .replace(/\\\\/g, '/')\n        // make sure there are no double '//'.\n        .replace(/\\/\\//g, '/')\n        // make sure the directory does not start with\n        // a '/'.\n        .replace(/^\\/+/g, '');\n    }\n\n    $scope.pushChanges = function($event) {\n      $event.target.blur();\n      var message = $scope.formData.commitMessage || `Updated note '${$scope.note.content.title}'`;\n\n      var fileExtension = $scope.formData.fileExtension;\n      var fileDirectory = $scope.formData.fileDirectory;\n      if(!$scope.defaultFileExtension) {\n        // set this as default\n        componentManager.setComponentDataValueForKey(\"defaultFileExtension\", fileExtension);\n        $scope.defaultFileExtension = fileExtension;\n      }\n\n      if(fileExtension !== $scope.noteFileExtension) {\n        // set this ext for this note\n        $scope.setDataForNote(\"fileExtension\", fileExtension);\n        $scope.noteFileExtension = fileExtension;\n      }\n\n      if(!$scope.defaultFileDirectory) {\n        // set this as default\n        componentManager.setComponentDataValueForKey(\"defaultFileDirectory\", fileDirectory);\n        $scope.defaultFileDirectory = fileDirectory;\n      }\n\n      if(fileDirectory !== $scope.noteFileDirectory) {\n        // set this directory for the note\n        $scope.setDataForNote(\"fileDirectory\", fileDirectory);\n        $scope.noteFileDirectory = fileDirectory;\n      }\n\n      $scope.formData.pushStatus = \"Pushing...\";\n      $scope.selectedRepoObject.writeFile(\"master\", $scope.sanitizeFileDirectory(fileDirectory) + $scope.note.content.title + \".\" + fileExtension, $scope.note.content.text, message, {encode: true}, function(err, result){\n        $timeout(function(){\n          if(!err) {\n            $scope.formData.commitMessage = \"\";\n            $scope.formData.pushStatus = \"Success!\";\n            $timeout(function(){\n              $scope.formData.pushStatus = \"Push Changes\";\n            }, 1500)\n          } else {\n            alert(\"Something went wrong trying to push your changes.\", + err);\n          }\n        })\n      });\n    }\n\n    $scope.logout = function() {\n      componentManager.clearComponentData();\n      $scope.hasDefaultRepo = null;\n      $scope.defaultFileExtension = null;\n      $scope.defaultFileDirectory = null;\n      $scope.noteFileExtension = null;\n      $scope.noteFileDirectory = null;\n      $scope.selectedRepo = null;\n      $scope.repos = null;\n      $scope.token = null;\n    }\n\n    componentManager.setSize(\"container\", \"100%\", defaultHeight);\n\n\n  }\n}\n\n// required for FireFox\nHomeCtrl.$$ngIsClass = true;\n\nangular.module('app').controller('HomeCtrl', HomeCtrl);\n"]}